<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Messenger Bot Launcher</title>
<style>
  body { font-family: Arial, sans-serif; background: linear-gradient(to right, #667eea, #764ba2); color: #fff; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
  .container { background: rgba(0,0,0,0.6); padding: 30px; border-radius: 15px; width: 350px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
  h2 { margin-bottom: 20px; }
  input, button { padding: 12px; margin: 10px 0; width: 100%; border-radius: 8px; border: none; }
  input { background: #fff; color: #333; }
  button { background: #4CAF50; color: #fff; cursor: pointer; font-weight: bold; transition: 0.3s; }
  button:hover { background: #45a049; }
  #status { font-weight: bold; margin-top: 15px; display: block; }
</style>
</head>
<body>
<div class="container">
  <h2>Messenger Bot Launcher</h2>

  <form id="startForm" enctype="multipart/form-data">
    <input type="file" id="appstate" required /><br/>
    <input type="text" id="owner" placeholder="Owner UID" required /><br/>
    <button type="submit">Start Bot</button>
  </form>

  <button id="stopBtn">Stop Bot</button>
  <span id="status">Loading...</span>
</div>

<script>
async function updateStatus() {
  try {
    const res = await fetch('/status');
    const data = await res.json();
    document.getElementById('status').textContent = data.running ? "Running ✅" : "Stopped ❌";
  } catch {
    document.getElementById('status').textContent = "Error ❌";
  }
}

updateStatus();
setInterval(updateStatus, 5000);

document.getElementById('startForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const appstateFile = document.getElementById('appstate').files[0];
  const ownerUID = document.getElementById('owner').value.trim();
  if(!appstateFile || !ownerUID) return alert("Both fields are required!");

  const formData = new FormData();
  formData.append("appstate", appstateFile);
  formData.append("owner", ownerUID);

  const res = await fetch('/start', { method: 'POST', body: formData });
  const data = await res.json();
  alert(data.message);
  updateStatus();
});

document.getElementById('stopBtn').addEventListener('click', async () => {
  const res = await fetch('/stop', { method: 'POST' });
  const data = await res.json();
  alert(data.message);
  updateStatus();
});
</script>
</body>
</html>
